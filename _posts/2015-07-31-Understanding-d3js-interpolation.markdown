---
layout: post
title:  "Understanding D3.js Interpolation"
date:   2015-07-31 12:57:49
categories: blog javascript
tags: javascript d3.js d3
comments: true
---

We have seen basics of d3 scale in this [article]({% post_url 2015-07-30-Understanding-d3js-scales %}), D3 scales use interpolation undeline, so what is interpolation, it is an function that maps one domain to range.

<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>

<strong> Domain </strong> by definition is set of all possible input value for given function.

<strong> Range </strong> by definition is set of all possible output value for given function.

Suppose there is domain (d1,d2) so there are n number of points in between d1 to d2 and you want to express this domain in the range of (r1,r2), where r1 and r2 are the smallest largest value of output.

If you have read my previous [blog]({% post_url 2015-07-30-Understanding-d3js-scales %}), you will understand in which situation we need such conversions, to explain in brief we need such conversions for mapping data to pixels for plotting chart. 

To get more clarity of how interpolation works consider following visuals, there a domain line having points from d1 to d2, similarly there is range line from r1 to r2.

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="442px" height="35px" version="1.1"><defs/><g transform="translate(0.5,0.5)"><path d="M 31 8 L 421 8" fill="none" stroke="#000000" stroke-width="4" stroke-miterlimit="10" pointer-events="none"/><rect x="1" y="13" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(13,17)"><switch><foreignObject pointer-events="all" width="16" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 16px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>d1</b></div></div></foreignObject><text x="8" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="400" y="13" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(412,17)"><switch><foreignObject pointer-events="all" width="16" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 16px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>d2</b></div></div></foreignObject><text x="8" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>


<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="621px" height="35px" version="1.1"><defs/><g transform="translate(0.5,0.5)"><path d="M 31 8 L 591 8" fill="none" stroke="#000000" stroke-width="4" stroke-miterlimit="10" pointer-events="none"/><rect x="1" y="13" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(14,17)"><switch><foreignObject pointer-events="all" width="14" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 14px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>r1</b></div></div></foreignObject><text x="7" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="579" y="13" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(592,17)"><switch><foreignObject pointer-events="all" width="14" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 14px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>r2</b></div></div></foreignObject><text x="7" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>



There is a point d in domain (d1,d2)

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="442px" height="75px" version="1.1"><defs/><g transform="translate(0.5,0.5)"><path d="M 31 36 L 421 36" fill="none" stroke="#000000" stroke-width="4" stroke-miterlimit="10" pointer-events="none"/><rect x="1" y="41" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(13,45)"><switch><foreignObject pointer-events="all" width="16" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 16px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>d1</b></div></div></foreignObject><text x="8" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="151" y="43" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(167,47)"><switch><foreignObject pointer-events="all" width="9" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 9px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>d</b></div></div></foreignObject><text x="5" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="400" y="41" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(412,45)"><switch><foreignObject pointer-events="all" width="16" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 16px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>d2</b></div></div></foreignObject><text x="8" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 47.37 51 L 154.63 51" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 42.12 51 L 49.12 47.5 L 47.37 51 L 49.12 54.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 159.88 51 L 152.88 54.5 L 154.63 51 L 152.88 47.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="71" y="53" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(75,57)"><switch><foreignObject pointer-events="all" width="33" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 33px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>d - d1</b></div></div></foreignObject><text x="17" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 37.37 21 L 404.63 21" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 32.12 21 L 39.12 17.5 L 37.37 21 L 39.12 24.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 409.88 21 L 402.88 24.5 L 404.63 21 L 402.88 17.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="186" y="1" width="55" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(194,5)"><switch><foreignObject pointer-events="all" width="40" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 51px; width: 40px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>d2 - d1</b></div></div></foreignObject><text x="20" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>


You want to express this point in range (r1,r2)

One thing is clear that **d1** corresponds to **r1** and **d2** to **r2**

Now suppose say point **r** corresponds to **d** and shown as

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="621px" height="116px" version="1.1"><defs/><g transform="translate(0.5,0.5)"><path d="M 31 66 L 591 66" fill="none" stroke="#000000" stroke-width="4" stroke-miterlimit="10" pointer-events="none"/><rect x="1" y="71" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(14,75)"><switch><foreignObject pointer-events="all" width="14" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 14px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>r1</b></div></div></foreignObject><text x="7" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="579" y="71" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(592,75)"><switch><foreignObject pointer-events="all" width="14" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 14px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>r2</b></div></div></foreignObject><text x="7" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="261" y="74" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(278,78)"><switch><foreignObject pointer-events="all" width="7" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 7px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>r</b></div></div></foreignObject><text x="4" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 47.37 88 L 254.63 88" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 42.12 88 L 49.12 84.5 L 47.37 88 L 49.12 91.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 259.88 88 L 252.88 91.5 L 254.63 88 L 252.88 84.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="121" y="94" width="40" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(127,98)"><switch><foreignObject pointer-events="all" width="29" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 36px; width: 29px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>r - r1</b></div></div></foreignObject><text x="15" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 37.37 21 L 574.63 21" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 32.12 21 L 39.12 17.5 L 37.37 21 L 39.12 24.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 579.88 21 L 572.88 24.5 L 574.63 21 L 572.88 17.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="261" y="1" width="50" height="20" fill="none" stroke="none" pointer-events="none"/><g transform="translate(267,5)"><switch><foreignObject pointer-events="all" width="39" height="16" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 16px; max-width: 46px; width: 39px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>r2  - r1</b></div></div></foreignObject><text x="20" y="14" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>

Then this should hold true

$${d - d1 \over d2 - d1} = {r - r1\over r2 - r1}$$

Solving above equation for r gives us

$$r = {(d - d1) \over (d2 - d1)} * (r2 - r1) + r1$$


if d1 = 0 and d2 = 1 then
<br>

````
r = r1 * (1 - d ) + r2 * d
````

Which is similar to what we have in d3.js interpolate function [here](https://github.com/mbostock/d3/wiki/Transitions#_interpolate)

{% highlight javascript%}
function interpolate(t) {
  return a * (1 - t) + b * t;
}
{% endhighlight %}

D3.js uses this function at many places, like in scales.

I hope this helped you to understand underlying logic of interpolation.